<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.rog//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 


<mapper namespace="com.project.sns.mapper.addrMapper">
		<insert id="inputAddr" parameterType="java.util.List">
			insert into TourMap(contentTypeId, contentId, title, tel, addr1, firstimage, firstimage2, cat2, cat3, mapx, mapy)
			values
			<foreach collection="list" item="item" separator=",">
				(#{item.contentTypeId}, #{item.contentId}, #{item.title, jdbcType=VARCHAR},
				#{item.tel, jdbcType=VARCHAR}, #{item.addr1, jdbcType=VARCHAR},
				#{item.firstimage, jdbcType=VARCHAR}, #{item.firstimage2, jdbcType=VARCHAR},
				#{item.cat2, jdbcType=VARCHAR}, #{item.cat3, jdbcType=VARCHAR},
				#{item.mapx, jdbcType=VARCHAR}, #{item.mapy, jdbcType=VARCHAR})
			</foreach>
		</insert>
		
		<insert id="inputAddrCat" parameterType="java.util.List">
			insert into TourMapCat(contentId, areacode, sigungucode)
			values
			<foreach collection="list" item="item" separator=",">
				(#{item.contentId}, #{item.areacode, jdbcType=VARCHAR}, #{item.sigungucode, jdbcType=VARCHAR})
			</foreach> 
		</insert>
		
		<delete id="deleteAddr" parameterType="com.project.sns.addr.vo.AddrVO">
			delete from TourMap <where>cat2=#{cat2}</where>
		</delete>
		
		<select id="getAddress" parameterType="int" resultType="AddrVO">
			select * from TourMap
		</select>

		<select id="getAddress2" parameterType="String" resultType="AddrVO">
             select * 
             from TourMap
             <where>
             contentTypeId not in('39','32')
             and addr1 like '%강남%'
                 <if test="value != null">
                      and inside = #{value}
                   </if>
                </where>
             ORDER BY rand()
            limit 9
      </select>
      
      <select id="getAddress3"  resultType="AddrVO">
	    select * 
	    from TourMap t, TourReview r
	    <where>
	   	 t.contentId = r.contentId
	   	 and addr1 like '%강남%'
	  	 and cat3 = 'A05020100'
	   	 and scope is not null
	   	 and scope > 4.0
	    </where>
	    ORDER BY rand()
	    limit 1;
      </select>
      
     <select id ="getAddrWithCode" resultType="AddrVO">
      select * from TourMap m, TourMapCat c <where>m.contentId = c.contentId and sigungucode = #{sigungucode}</where>
   	 </select> 
   	 
   	 <select id="callInfo" parameterType="String" resultType="AddrVO">
   	 	select * from TourMap
   	 	<where>
   	 	contentId = #{value}
   	 	</where>
   	 </select>
   	 
   	 <select id="callReview" parameterType="String" resultType="AddrVO">
   	 	select * from TourReview
   	 	<where>
   	 	contentId = #{value}
   	 	</where>
   	 </select>
   	 
   	 <select id="getStarAvg" parameterType="String" resultType="double">
   	 	select COALESCE(AVG(star),0) from Board
   	 	<where>
   	 	contentId = #{value}
   	 	</where>
   	 </select>
   	 

		
</mapper>