<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.project.mapper.chatMapper">

	<insert id = "submit" parameterType="ChatVO">
		insert into CHAT (fromID, toID, chatContent, chatTime, chatRead)
		values (#{fromID}, #{toID}, #{chatContent}, NOW(), 0)
	</insert>
	
	<select id = "listByID" parameterType="ChatVO" resultType="ChatVO">
	SELECT * FROM CHAT 
	WHERE ((fromID =#{fromID} AND toID =#{toID}) 
	OR (fromID =#{toID} AND toID =#{fromID})) 
	AND chatID > #{chatID}
	ORDER BY chatID

	</select>
	
	<select id = "listByRecent" parameterType="ChatVO" resultType="ChatVO">
	SELECT * FROM CHAT 
	WHERE ((fromID = #{fromID} and toID = #{toID}) 
	OR (fromID = #{toID} AND toID = #{fromID})) 
	AND chatID > (SELECT MAX(chatID) - 100 FROM CHAT) 
	ORDER BY chatTime
	</select>
	
	<update id = "readChat" parameterType="ChatVO">
	UPDATE CHAT 
	SET chatRead = 1
	WHERE (fromID =#{fromID} AND toID =#{toID}) 
	AND chatID &lt; ${chatID}
	</update>
	
	<select id = "newChat" parameterType="ChatVO" resultType="int">
	SELECT * FROM CHAT
	WHERE (fromID = #{userID}) 
	AND chatRead = 0
	</select>
</mapper>